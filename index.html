<!DOCTYPE html>
<html class="no-js" lang="">
	<head>
		<meta charset="utf-8" />
		<title></title>
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="site.webmanifest" />
		<link rel="apple-touch-icon" href="icon.png" />
		<!-- Place favicon.ico in the root directory -->
		<meta name="theme-color" content="#fafafa" />
	</head>
	<style type="text/css">
		body {
			background: #021909;
			margin: 0;
			padding: 0;
			font-family: helvetica;
		}
		#header {
			position: absolute;
			width: 100%;
			text-align: center;
			margin: 50px 0 100px;
		}
		h1,
		h2,
		h3 {
			color: #d7eef7;
		}
		p {
			color: #4dd3ff;
		}
		canvas {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
		}
		#pic {
			background: rgba(0, 0, 0, 0.8);
			border-radius: 20px;
			box-shadow: 0 0 16px rgba(0, 0, 0, 0.8);
			width: 80%;
			max-width: 400px;
		}
	</style>
	<body>
		<canvas id="bg"></canvas>
		<section id="header">
			<h1>Esque Design Ltd</h1>
			<h2>Contact</h2>
			<p>ABN:</p>
			<p>Contact:</p>
			<p>linked in</p>
			<p>twitter</p>
			<h2>Work</h2>
			<h3>Airtasker</h3>
			<h3>SquashMatch</h3>
			<h3>FunkyVector</h3>
			<h3>MadeComfy</h3>
			<p>work</p>
			<img src="https://api.funkyvector.com/iotd.php" id="pic" />
		</section>

		<script type="text/javascript">
			var pic = document.getElementById("pic");

			function renderBG() {
				var TAU = Math.PI * 2;

				var gradient = [
					{ r: 250, g: 250, b: 249, a: 0, position: 0 },
					{
						r: 99,
						g: 201,
						b: 199,
						a: 100,
						position: 0.1 + Math.random() * 0.3
					},
					{
						r: 75,
						g: 150,
						b: 163,
						a: 140,
						position: 0.6 + Math.random() * 0.3
					},
					{ r: 52, g: 101, b: 127, a: 200, position: 1 }
				];
				var width = 1000;
				var height = 2000;
				var cx = (0.4 + Math.random() * 0.2) * width;
				var cy = (0.4 + Math.random() * 0.2) * height;
				var rotation = Math.random() * TAU;

				var gradientRev = gradient.slice().reverse();

				var canvas = document.getElementById("bg");
				canvas.width = width;
				canvas.height = height;

				var ctx = canvas.getContext("2d");
				var imageData = ctx.getImageData(0, 0, width, height);
				var data = imageData.data;

				function lerp(a, b, ratio) {
					return a + (b - a) * ratio;
				}

				// work out which colours stops to do linear interpolation between

				function getSteps(ratio) {
					var exact = gradientRev.find(function(step) {
						return ratio === step.position;
					});
					if (exact)
						return {
							exact: exact
						};
					return {
						start: gradientRev.find(function(step) {
							return ratio >= step.position;
						}),
						end: gradient.find(function(step) {
							return ratio < step.position;
						})
					};
				}

				var x, y;

				for (var i = 0; i < data.length; i += 4) {
					var index = i / 4;
					x = index % width;
					y = Math.floor(index / width);
					var dx = cx - x;
					var dy = cy - y;
					var angle =
						Math.atan(dy / dx) -
							(dx < 0 ? 0 : Math.PI) +
							Math.PI / 2 +
							Math.PI || 0;
					var ratio = ((angle + rotation) % TAU) / TAU;

					var _getSteps = getSteps(ratio),
						exact = _getSteps.exact,
						start = _getSteps.start,
						end = _getSteps.end;

					var r, g, b, a;

					if (exact) {
						r = exact.r;
						g = exact.g;
						b = exact.b;
						a = exact.a;
					} else if (start && end) {
						var stepRatio =
							(ratio - start.position) / (end.position - start.position);
						r = lerp(start.r, end.r, stepRatio);
						g = lerp(start.g, end.g, stepRatio);
						b = lerp(start.b, end.b, stepRatio);
						a = lerp(start.a, end.a, stepRatio);
					} else {
						// console.warn("error finding gradient steps", exact, start, end, ratio);
						//return null;
					}

					data[i] = r;
					data[i + 1] = g;
					data[i + 2] = b;
					data[i + 3] = a;
				} // antialias the line

				var stripeCoords = [];

				for (
					var j = -2;
					j < 2000 && x > 0 && x < width && y > 0 && y < height;
					j++
				) {
					// j is distance from centre of rotation...
					x = Math.round(cx + Math.sin(rotation) * j);
					y = Math.round(cy + Math.cos(rotation) * j);

					var _index = (y * width + x) * 4;

					stripeCoords.push({
						x: x,
						y: y,
						index: _index
					});
				}

				function getPixel(x, y) {
					if (x > 0 && x < width && y > 0 && y < height) {
						var _index2 = (y * width + x) * 4;

						return {
							r: data[_index2],
							g: data[_index2 + 1],
							b: data[_index2 + 2],
							a: data[_index2 + 3]
						};
					}

					return null; // pixel is off screen
				}

				function getNeighbours(x, y) {
					return [
						getPixel(x - 1, y - 1), // top left
						getPixel(x, y - 1), // top centre
						getPixel(x + 1, y - 1), // top right
						getPixel(x - 1, y), // middle left
						getPixel(x, y), // middle centre
						getPixel(x + 1, y), // middle right
						getPixel(x - 1, y + 1), // bottom left
						getPixel(x, y + 1), // bottom centre
						getPixel(x + 1, y + 1)
					].filter(Boolean); // remove off screen pixels
				}

				function getAverage(x, y) {
					var pixels = getNeighbours(x, y); // calculate totals

					var totals = pixels.reduce(
						function(acc, _ref) {
							var r = _ref.r,
								g = _ref.g,
								b = _ref.b,
								a = _ref.a;
							return {
								r: r + acc.r,
								g: g + acc.g,
								b: b + acc.b,
								a: a + acc.a
							};
						},
						{
							r: 0,
							g: 0,
							b: 0,
							a: 0
						}
					); // calculate average

					var average = {
						r: Math.round(totals.r / pixels.length),
						g: Math.round(totals.g / pixels.length),
						b: Math.round(totals.b / pixels.length),
						a: Math.round(totals.a / pixels.length)
					};
					return average;
				}

				var averages = stripeCoords.map(function(_ref2) {
					var x = _ref2.x,
						y = _ref2.y,
						index = _ref2.index;

					var _getAverage = getAverage(x, y),
						r = _getAverage.r,
						g = _getAverage.g,
						b = _getAverage.b,
						a = _getAverage.a;

					return {
						index: index,
						r: r,
						g: g,
						b: b,
						a: a
					};
				}); // draw antialiased pixels back to canvas

				averages.forEach(function(_ref3) {
					var index = _ref3.index,
						r = _ref3.r,
						g = _ref3.g,
						b = _ref3.b,
						a = _ref3.a;
					data[index] = r;
					data[index + 1] = g;
					data[index + 2] = b;
					data[index + 3] = a;
				});
				ctx.putImageData(imageData, 0, 0);
			}

			setInterval(function() {
				pic.src = "https://api.funkyvector.com/iotd.php?" + Math.random();
			}, 100000);
			renderBG();
			setInterval(renderBG, 5000);
		</script>
	</body>
</html>
